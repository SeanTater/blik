language: rust
rust:
 - 1.19.0
 - stable
cache: cargo
services:
 - postgresql
before_script:
 - cargo update || true
 - echo "DATABASE_URL=postgres://localhost/rphotos" > .env
 - cargo install -v diesel_cli --no-default-features --features postgres || true
 - $HOME/.cargo/bin/diesel setup
matrix:
  include:
   - rust: nightly
     env: TASK=rustfmt
     before_script:
      - export PATH="$PATH:$HOME/.cargo/bin"
      - if [[ $(rustfmt --version) < '0.2.15' ]]; then cargo install -f rustfmt-nightly; fi
      - rustfmt --version
     script:
      - cargo fmt -- --write-mode=diff
