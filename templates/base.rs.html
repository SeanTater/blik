@use crate::models::Story;
@use super::statics::*;
@use itertools::Itertools;
@use chrono::Datelike;
@use diesel::sqlite::SqliteConnection;

@(db: &SqliteConnection, title: &str, meta: Content, content: Content)

<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Blik: Easy photo manager.">
    <title>Blik &ndash; @title</title>
    <link rel="stylesheet" href="/static/@pure_min_css.name">
    <link rel="stylesheet" href="/static/@layout_css.name">
    <link rel="stylesheet" href="/static/@photos_css.name">
    @:meta()
</head>
<body>

<div id="layout" class="content pure-g">
    <div id="nav" class="pure-u">
        <a href="#" id="menuLink" class="nav-menu-button">Menu</a>

        <div class="nav-inner">
            <!-- <button class="primary-button pure-button">Upload</button> -->

            <div class="pure-menu">
                <ul class="pure-menu-list">
                    <li class="pure-menu-item"><a href="/" class="pure-menu-link">Home</a></li>
                    @for year in Story::all(db).unwrap_or_default().iter().map(|st| st.created_on.year()).unique() {
                      <li class="pure-menu-item"><a href="/year/@year" class="pure-menu-link">@year</a></li>
                    }
                    <li class="pure-menu-heading">Labels</li>
                    <li class="pure-menu-item"><a href="#" class="pure-menu-link"><span class="email-label-personal"></span>Personal</a></li>
                    <li class="pure-menu-item"><a href="#" class="pure-menu-link"><span class="email-label-work"></span>Work</a></li>
                    <li class="pure-menu-item"><a href="#" class="pure-menu-link"><span class="email-label-travel"></span>Travel</a></li>
                    <li class="pure-menu-heading"><a href="https://github.com/SeanTater/blik">
                      blik
                      @env!("CARGO_PKG_VERSION")
                    </a>.</li>
                </ul>
            </div>
        </div>
    </div>

    <div id="list" class="pure-u-1">
        @for story in Story::all(db).unwrap_or_default() {
          <!-- Also available: email-item-selected email-item-unread -->
          <div class="email-item email-item-selected pure-g">
            <div class="pure-u">
                <img width="64" height="64" alt="Latest photo" class="email-avatar" src="/media/@story.latest_media.unwrap_or_default()/thumbnail">
            </div>

            <div class="pure-u-3-4">
                <h4 class="email-subject">
                  <a href="/story/@story.name">
                    @story.title
                  </a>
                </h4>
                <h5 class="email-name">@story.media_count media</h5>
                <p class="email-desc">
                  @story.description
                </p>
            </div>
        </div>
        }
        <div class="email-item pure-g">
          <div class="pure-u">
            <form
              class="pure-form pure-form-stacked pure-form-aligned"
              action="/story"
              method="POST">
              <fieldset>
                <legend>Create a new story</legend>
                <input type="text" name="title" class="pure-input-1" placeholder="Allens third birthday" />
                <textarea name="description" class="pure-input-1" placeholder="When uncle Gene lost his dentures"></textarea>
                <button type="submit" class="pure-button pure-button-primary">Create</button>
              </fieldset>
            </form>
          </div>
        </div>
    </div>

    <div id="main" class="pure-u-1">
        @:content()
    </div>
</div>
<!-- Script to make the Menu link work -->
<!-- Just stripped down version of the js/ui.js script for the side-menu layout -->
<script src="/static/@layout_side_menu_js.name"></script>
</body>
</html>
