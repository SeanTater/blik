@use super::base;
@use crate::models::{Photo, Story};
@use diesel::sqlite::SqliteConnection;
@use rocket::request::FlashMessage;

@(title: &str, flash: Option<FlashMessage>, db: &SqliteConnection)

@:base(title, {}, {
  @for message in flash {
    <div class="card flash-message flash-@message.name()">@message.msg()</div>
  }
  <div class="card compose">
    <form action="/photo" method="POST"  enctype="multipart/form-data">
      <textarea name="description">Create a new story</textarea>
      <input type="file" name="image" accept="image/*,video/*" multiple />
      <button>Upload</button>
    </form>
  </div>
  <div class="story">
    @for st in &Story::recent(db).unwrap_or(vec![]) {
      <div class="group">
        <h2>@st.name</h2>
        <p>
          @st.description.as_ref().map(|x|x.as_ref()).unwrap_or("")
        </p>
        @for photo in st.related_photos(db).unwrap() {
          <label class="card item expandable">
            <input type="checkbox" class="hide">
            <img src="/photo/@photo.id/thumbnail" alt="Photo @photo.id" />
            <extra-drawer>
              <lazy-img style="background-image: url(/photo/@photo.id)" />
            </extra-drawer>
          </label>
        }
      </div>
    }
  </div>
})
