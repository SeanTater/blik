@use super::base;
@use crate::models::{Photo, Story};
@use diesel::sqlite::SqliteConnection;
@use rocket::request::FlashMessage;
@use crate::template_utils::*;

@(db: &SqliteConnection, story: &Story, flash: Option<FlashMessage>)

@:base(db, &story.name, {}, {
    @for message in flash {
        <div class="card flash-message flash-@message.name()">@message.msg()</div>
    }
    <div class="email-content">
        <div class="email-content-header pure-g">
            <div class="pure-u-1">
                <h1 class="email-content-title">@story.title</h1>
                <p class="email-content-subtitle">
                    Last updated on <span>@story.last_updated</span>
                </p>
            </div>

            <div class="email-content-controls pure-u-1">
                <form
                    class="pure-form pure-g"
                    action="/story/@story.name"
                    method="POST"
                    enctype="multipart/form-data">
                    <input type="file" name="image" accept="image/*,video/*" multiple class="pure-input-2-3" />
                    <button type="submit" class="pure-button pure-button-primary" class="pure-u-1-3">Upload photos</button>
                </form>
                <!-- <button class="secondary-button pure-button">Add Photos</button>
                <button class="secondary-button pure-button">Forward</button>
                <button class="secondary-button pure-button">Move to</button> -->
            </div>
        </div>

        <div class="email-content-body">
            <p>
                @story.description
            </p>
            <photo-deck>
                @for photo in story.related_photos(db).unwrap_or_default() {
                    <label class="card item expandable">
                        <input type="checkbox" class="hide">
                        <img src="/photo/@photo.id/thumbnail" alt="Photo @photo.id" />
                        <extra-drawer>
                            <lazy-img style="background-image: url(/photo/@photo.id)" />
                        </extra-drawer>
                    </label>
                }
            </photo-deck>
        </div>
    </div>
})
