@use super::base;
@use crate::models::{Media, Story};
@use diesel::sqlite::SqliteConnection;
@use rocket::request::FlashMessage;
@use crate::template_utils::*;

@(db: &SqliteConnection, year: Option<i32>, flash: Option<FlashMessage>)

@:base(db, "Timeline", {}, {
    @for message in flash {
        <div class="card flash-message flash-@message.name()">@message.msg()</div>
    }
    @for story in &Story::recent(db, year).unwrap_or(vec![]) {
        <div class="email-content">
            <div class="email-content-header pure-g">
                <div class="pure-u-1-2">
                    <h1 class="email-content-title">
                        <a href="/story/@story.name">
                            @story.title
                        </a>
                    </h1>
                    <p class="email-content-subtitle">
                        Last updated <span>@story.last_updated</span>
                    </p>
                </div>

                <div class="email-content-controls pure-u-1-2">
                    <!-- <button class="secondary-button pure-button">Reply</button>
                    <button class="secondary-button pure-button">Forward</button>
                    <button class="secondary-button pure-button">Move to</button> -->
                </div>
            </div>

            <div class="email-content-body">
                <p>
                    @story.description
                </p>
                <h4>@story.media_count media</h4>
                <media-deck>
                    @for media in story.related_media(db).unwrap_or_default().iter().take(10) {
                        <label class="card item expandable">
                            <input type="checkbox" class="hide">
                            <img src="/media/@media.id/thumbnail" alt="Photo/Video @media.id" />
                            <extra-drawer>
                                <lazy-img style="background-image: url(/media/@media.id)" />
                            </extra-drawer>
                        </label>
                    }
                </media-deck>
            </div>
        </div>
    }
})
